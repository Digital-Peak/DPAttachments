!function(r,s){"use strict";function i(o,t){t.length&&Array.prototype.forEach.call(t,function(t){var a=o.form.querySelector(".dp-form__progress");a.style.display="block",a.value=0;var n=new XMLHttpRequest;n.open("post",o.form.getAttribute("action"),!0),n.setRequestHeader("X-CSRF-Token",s.getOptions("csrf.token","")),n.onreadystatechange=function(){if(4===n.readyState&&(a.style.display="none",200===n.status)){var t=JSON.parse(n.responseText);s.renderMessages(t.messages);var e=r.querySelector('.com-dpattachments-layout-attachments__attachments[data-context="'+t.data.context+'"][data-item="'+t.data.item_id+'"]');e.parentElement.classList.remove("com-dpattachments-layout-attachments_empty"),e.innerHTML+=t.data.html,o.value=""}},n.upload.addEventListener("progress",function(t){t.lengthComputable&&(a.value=Math.round(100*t.loaded/t.total))},!1);var e=new FormData(o.form);e.append("file",t),n.send(e)})}r.addEventListener("DOMContentLoaded",function(){[].slice.call(r.querySelectorAll(".com-dpattachments-layout-form .dp-input__file")).forEach(function(d,t){d.addEventListener("change",function(t){i(d,d.files)},!1),d.addEventListener("drop",function(t){t.stopPropagation(),t.preventDefault(),i(d,t.dataTransfer.files)},!1),0==t&&r.querySelector("body").addEventListener("paste",function(t){for(var e=[],a=(t.clipboardData||{}).items||[],n=0;n<a.length;n++){var o=a[n].getAsFile();if(o){var r=new RegExp("/(.*)").exec(o.type);if(!o.name&&r){var s=r[1];o.name="clipboard"+n+"."+s}e.push(o)}}e.length&&(i(d,e),t.preventDefault(),t.stopPropagation())},!1),[].slice.call(r.querySelectorAll(".com-dpattachments-layout-form")).forEach(function(e){var a=!1;e.addEventListener("dragenter",function(t){a||(t.stopPropagation(),t.preventDefault(),e.classList.add("com-dpattachments-layout-form_drag"))},!1),e.addEventListener("dragleave",function(t){a||(t.stopPropagation(),t.preventDefault(),e.classList.remove("com-dpattachments-layout-form_drag"))},!1),e.addEventListener("dragover",function(t){a||(t.stopPropagation(),t.preventDefault(),e.classList.add("com-dpattachments-layout-form_drag"))},!1),e.addEventListener("drop",function(t){a||(t.stopPropagation(),t.preventDefault(),e.classList.remove("com-dpattachments-layout-form_drag"),i(e.querySelector(".dp-input__file"),t.dataTransfer.files))},!1),r.body.addEventListener("dragstart",function(t){a=!0},!0),r.body.addEventListener("dragend",function(t){a=!1},!0),r.body.addEventListener("drop",function(t){t.dataTransfer.files&&t.dataTransfer.files.length&&(t.stopPropagation(),t.preventDefault())},!1)})})})}(document,Joomla);
