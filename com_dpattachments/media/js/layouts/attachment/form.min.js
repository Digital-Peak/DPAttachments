!function(r,s){"use strict";var i=function(o,e){e.length&&Array.prototype.forEach.call(e,function(e){var t=o.form.querySelector(".dp-form__progress");t.style.display="block",t.value=0;var a=new XMLHttpRequest;a.open("post",o.form.getAttribute("action"),!0),a.setRequestHeader("X-CSRF-Token",s.getOptions("csrf.token","")),a.onreadystatechange=function(){if(4===a.readyState&&(t.style.display="none",200===a.status)){var e=JSON.parse(a.responseText);s.renderMessages(e.messages),r.querySelector('.com-dpattachments-layout-attachments__attachments[data-context="'+e.data.context+'"][data-item="'+e.data.item_id+'"]').innerHTML+=e.data.html,o.value=""}},a.upload.addEventListener("progress",function(e){e.lengthComputable&&(t.value=Math.round(100*e.loaded/e.total))},!1);var n=new FormData(o.form);n.append("file",e),a.send(n)})};r.addEventListener("DOMContentLoaded",function(){[].slice.call(r.querySelectorAll(".com-dpattachments-layout-form .dp-input__file")).forEach(function(d,e){d.addEventListener("change",function(e){i(d,d.files)},!1),d.addEventListener("drop",function(e){e.stopPropagation(),e.preventDefault(),i(d,e.dataTransfer.files)},!1),0==e&&r.querySelector("body").addEventListener("paste",function(e){for(var t=[],a=(e.clipboardData||{}).items||[],n=0;n<a.length;n++){var o=a[n].getAsFile();if(o){var r=new RegExp("/(.*)").exec(o.type);if(!o.name&&r){var s=r[1];o.name="clipboard"+n+"."+s}t.push(o)}}t.length&&(i(d,t),e.preventDefault(),e.stopPropagation())},!1)})})}(document,Joomla);
